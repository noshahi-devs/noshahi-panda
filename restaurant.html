<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu | Noshahi Panda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8f9fa;
        }

        /* Hero Header */
        .res-hero {
            height: 350px;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            align-items: flex-end;
            color: white;
            padding-bottom: 3rem;
            transition: height 0.3s;
        }

        @media (max-width: 768px) {
            .res-hero {
                height: 250px;
                padding-bottom: 1.5rem;
            }

            .res-hero h1 {
                font-size: 2rem !important;
            }
        }

        .res-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.2) 60%);
        }

        .res-hero-content {
            position: relative;
            z-index: 10;
        }

        /* Menu Section */
        .menu-category-nav {
            position: sticky;
            top: 70px;
            background: white;
            z-index: 100;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .menu-item-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #f0f0f0;
            display: flex;
            gap: 1.5rem;
        }

        .menu-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border-color: var(--brand-red);
        }

        .menu-item-img {
            width: 140px;
            height: 140px;
            border-radius: 15px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .add-btn {
            background: var(--brand-red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s;
        }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(215, 15, 100, 0.3);
        }

        /* Category Nav */
        .category-nav-wrapper {
            position: sticky;
            top: 70px;
            background: white;
            z-index: 95;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
        }

        .category-nav {
            display: flex;
            gap: 2rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: none;
        }

        .category-nav::-webkit-scrollbar {
            display: none;
        }

        .category-link {
            text-decoration: none;
            color: #666;
            font-weight: 600;
            white-space: nowrap;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .category-link.active {
            color: var(--brand-red);
            border-bottom-color: var(--brand-red);
        }

        .category-section-title {
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f0f0;
            position: relative;
        }

        .category-section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 2px;
            background: var(--brand-red);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .menu-item-card {
                flex-direction: column-reverse;
                gap: 1rem;
            }

            .menu-item-img {
                width: 100%;
                height: 180px;
            }
        }
    </style>
</head>

<body>

    <!-- Simple Navbar -->
    <nav class="navbar navbar-light bg-white sticky-top shadow-sm py-3">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
                <div class="brand-logo me-2">
                    <span class="logo-n">N</span>
                </div>
                <span><span class="text-orange">Noshahi</span> Panda</span>
            </a>
            <div class="d-flex align-items-center gap-3">
                <div class="cart-icon position-relative cursor-pointer" onclick="toggleCart()">
                    <i class="fa-solid fa-basket-shopping fs-4 text-dark"></i>
                    <span
                        class="cart-badge position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                        style="font-size:0.6rem">0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Header -->
    <header class="res-hero" id="resHero">
        <div class="container res-hero-content">
            <h1 class="display-4 fw-bold mb-2" id="resName">Restaurant Name</h1>
            <div class="d-flex flex-wrap gap-3 align-items-center">
                <span class="badge bg-white text-dark py-2 px-3 rounded-pill">
                    <i class="fa-solid fa-star text-warning me-1"></i> <span id="resRating">4.8</span> (<span
                        id="resReviews">500+ reviews</span>)
                </span>
                <span class="text-white-50 fs-5">•</span>
                <span class="text-white" id="resCuisine">Pizza • Italian</span>
                <span class="text-white-50 fs-5">•</span>
                <span class="text-white"><i class="fa-regular fa-clock me-1"></i> 25-30 min</span>
            </div>
        </div>
    </header>

    <!-- Category Navigation -->
    <div class="category-nav-wrapper">
        <div class="container">
            <div class="category-nav" id="categoryNav">
                <!-- Populated via JS -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container py-5">
        <div class="row">
            <div class="col-lg-8">
                <div id="menuContainer">
                    <!-- Menu Sections Loaded via JS -->
                    <div class="text-center py-5">
                        <div class="spinner-border text-danger" role="status"></div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Info -->
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm rounded-4 p-4 sticky-top" style="top: 100px;">
                    <h5 class="fw-bold mb-3">Restaurant Info</h5>
                    <div class="mb-3">
                        <div class="small text-muted mb-1">Address</div>
                        <div class="fw-bold" id="resAddress">123 Food Street, Gulberg III, Lahore</div>
                    </div>
                    <div class="mb-3">
                        <div class="small text-muted mb-1">Opening Hours</div>
                        <div class="fw-bold" id="resHours">11:00 AM - 12:00 AM</div>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Minimum Order</span>
                        <span class="fw-bold" id="resMinOrder">Rs. 300</span>
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                        <span>Delivery Fee</span>
                        <span class="fw-bold text-success" id="resDeliveryFee">FREE</span>
                    </div>
                    <button onclick="shareRestaurant()" id="shareBtn"
                        class="btn btn-outline-danger w-100 rounded-pill py-2 fw-bold">
                        <i class="fa-solid fa-share-nodes me-2"></i> Share Restaurant
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Cart Sidebar (Same as index.html) -->
    <div class="cart-overlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold mb-0">Your Basket</h4>
            <button class="btn-close" onclick="toggleCart()"></button>
        </div>
        <div id="cart-drawer-items" class="flex-grow-1 overflow-auto pe-2">
            <!-- Items from JS -->
        </div>
        <div class="border-top pt-4 mt-4">
            <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Subtotal</span>
                <span class="fw-bold" id="cart-total-price">Rs. 0</span>
            </div>
            <div class="d-flex justify-content-between mb-4">
                <span class="text-muted">Delivery Fee</span>
                <span class="text-success fw-bold">FREE</span>
            </div>
            <div id="min-order-warning" class="alert alert-warning small py-2 d-none mb-3">
                <i class="fa-solid fa-circle-exclamation me-2"></i>
                Min. order is <span id="cart-min-order-val">Rs. 300</span>
            </div>
            <a href="javascript:void(0)" id="checkoutBtn" onclick="proceedToCheckout()"
                class="btn btn-brand-red w-100 py-3 fw-bold rounded-3 shadow-lg"
                style="background: var(--brand-red); color: white;">Checkout</a>
        </div>
    </div>

    <!-- Scripting -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const resId = params.get('id');

            // --- Load Restaurant Data ---
            const allRestaurants = [
                { id: 1, name: "The Burger Club", image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=800", rating: "4.8", reviews: "500+", cuisine: "Burgers • American" },
                { id: 2, name: "Pizza Napoletana", image: "https://images.unsplash.com/photo-1574126154517-d1e0d89ef734?w=800", rating: "4.5", reviews: "1k+", cuisine: "Pizza • Italian" },
                { id: 3, name: "Chopstick House", image: "https://images.unsplash.com/photo-1525755662778-989d0524087e?w=800", rating: "4.3", reviews: "200+", cuisine: "Pan Asian • Chinese" },
                { id: 4, name: "The Green Bowl", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=800", rating: "4.9", reviews: "50+", cuisine: "Salads • Healthy" },
                { id: 5, name: "Royal Desi Kitchen", image: "https://images.unsplash.com/photo-1626777553733-bb02998396ec?w=800", rating: "4.6", reviews: "3k+", cuisine: "Pakistani • Curry" },
                { id: 6, name: "Frosty Delights", image: "https://images.unsplash.com/photo-1501443762994-82bd5dace89a?w=800", rating: "4.7", reviews: "800+", cuisine: "Desserts • Ice Cream" }
            ];

            // Add dynamic ones from localStorage
            const storedRes = JSON.parse(localStorage.getItem('noshahi_all_restaurants') || '[]');
            storedRes.forEach((r) => {
                allRestaurants.push({
                    id: r.id, // Use the actual timestamp ID
                    name: r.name,
                    image: r.image || "https://images.unsplash.com/photo-1414228646450-48e025f16104?w=800", // Use captured image
                    rating: r.rating || "New",
                    reviews: "0",
                    cuisine: r.cuisine || "Multi-cuisine",
                    address: r.address || "Main Street, Lahore",
                    hours: r.hours || r.operatingDetails?.hours || "11:00 AM - 12:00 AM",
                    minOrder: r.minOrder || r.operatingDetails?.minOrder || 300,
                    deliveryFee: r.deliveryFee || r.operatingDetails?.deliveryFee || 0
                });
            });

            const restaurant = allRestaurants.find(r => r.id == resId);

            if (!restaurant) {
                document.body.innerHTML = '<div class="container py-5 text-center"><h2>Restaurant not found</h2><a href="index.html">Back to Home</a></div>';
                return;
            }

            // Global ref for cart logic
            window.activeRestaurant = restaurant;

            // Fill Header Info
            document.getElementById('resHero').style.backgroundImage = `url('${restaurant.image}')`;
            document.getElementById('resName').innerText = restaurant.name;
            document.getElementById('resRating').innerText = restaurant.rating;
            document.getElementById('resReviews').innerText = `${restaurant.reviews} reviews`;
            document.getElementById('resCuisine').innerText = restaurant.cuisine;
            document.getElementById('resAddress').innerText = restaurant.address || "123 Food Street, Gulberg III, Lahore";
            document.getElementById('resHours').innerText = restaurant.hours;
            document.getElementById('resMinOrder').innerText = `Rs. ${restaurant.minOrder}`;
            document.getElementById('resDeliveryFee').innerText = restaurant.deliveryFee == 0 ? "FREE" : `Rs. ${restaurant.deliveryFee}`;

            // Update min order val in warning
            document.getElementById('cart-min-order-val').innerText = `Rs. ${restaurant.minOrder}`;

            // --- Load Menu Items ---
            const menuContainer = document.getElementById('menuContainer');
            menuContainer.innerHTML = '';

            // 1. Get real menu items from localStorage for this restaurant
            const realMenuKey = `noshahi_menu_${resId}`;
            const realMenuItems = JSON.parse(localStorage.getItem(realMenuKey) || '[]');

            // 2. Generate fallback / demo items if no real items
            const demoMenuItems = [
                { name: "Special Signature Dish", desc: "Our chef's special recipe made with premium ingredients and secret spices.", price: "850", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300", category: "Chef's Special" },
                { name: "Premium Combo Meal", desc: "A full satisfaction meal including main course, side dish, and a refreshing drink.", price: "1250", image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=300", category: "Deals" },
                { name: "Double Cheese Burger", desc: "Two beef patties with extra melted cheddar.", price: "750", image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300", category: "Burgers" },
                { name: "Classic Zinger", desc: "Crispy chicken breast with fresh lettuce and mayo.", price: "550", image: "https://images.unsplash.com/photo-1513185158878-8d8ae1997028?w=300", category: "Burgers" },
                { name: "Margherita Pizza", desc: "Fresh basil, tomatoes, and mozzarella.", price: "990", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=300", category: "Pizza" },
                { name: "Daily Delight", desc: "Freshly prepared every day with seasonal vegetables and tender marinated protein.", price: "650", image: "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=300", category: "Chef's Special" }
            ];

            const finalMenu = realMenuItems.length > 0 ? realMenuItems : demoMenuItems;

            // --- Group Menu by Category ---
            const groupedMenu = finalMenu.reduce((groups, item) => {
                const category = item.category || 'More Items';
                if (!groups[category]) groups[category] = [];
                groups[category].push(item);
                return groups;
            }, {});

            // Render Category Nav
            const categoryNav = document.getElementById('categoryNav');
            categoryNav.innerHTML = '';

            Object.keys(groupedMenu).forEach((category, index) => {
                const catId = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
                const navLink = document.createElement('a');
                navLink.href = `#${catId}`;
                navLink.className = `category-link ${index === 0 ? 'active' : ''}`;
                navLink.innerText = category;
                navLink.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById(catId).scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Custom offset scroll because of sticky header
                    const offset = 130; // height of both headers
                    const elementPosition = document.getElementById(catId).getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - offset;
                    window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                };
                categoryNav.appendChild(navLink);
            });

            // Render Grouped Menu
            Object.keys(groupedMenu).forEach(category => {
                const catId = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;

                // Category Title
                const title = document.createElement('h3');
                title.id = catId;
                title.className = 'category-section-title';
                title.innerText = category;
                menuContainer.appendChild(title);

                // Items in this category
                groupedMenu[category].forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'menu-item-card';
                    card.innerHTML = `
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="fw-bold mb-0">${item.name}</h5>
                                <button class="add-btn" onclick="addToCart('${item.name}', 'Rs. ${item.price}', '${item.image || restaurant.image}', '${restaurant.name}')">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </div>
                            <p class="text-muted small mb-3">${item.desc || 'No description available for this item.'}</p>
                            <div class="fw-bold fs-5 text-dark">Rs. ${item.price}</div>
                        </div>
                        <img src="${item.image || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300'}" class="menu-item-img border shadow-sm">
                    `;
                    menuContainer.appendChild(card);
                });
            });

            // Scroll Spy for Category Nav
            window.addEventListener('scroll', () => {
                const categories = Object.keys(groupedMenu).map(cat =>
                    `category-${cat.replace(/\s+/g, '-').toLowerCase()}`
                );

                let current = '';
                const offset = 140;

                categories.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && window.pageYOffset >= element.offsetTop - offset) {
                        current = id;
                    }
                });

                document.querySelectorAll('.category-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });

            // --- Cart Logic (Ported from script.js) ---
            let cart = JSON.parse(localStorage.getItem('pandaCart') || '[]');

            window.toggleCart = function () {
                document.querySelector('.cart-sidebar').classList.toggle('active');
                document.querySelector('.cart-overlay').classList.toggle('active');
            };

            window.addToCart = function (name, price, img, restaurantName) {
                const existing = cart.find(i => i.name === name);
                if (existing) {
                    existing.quantity += 1;
                } else {
                    cart.push({ name, price, img, restaurant: restaurantName, quantity: 1 });
                }
                updateCartUI();
                if (!document.querySelector('.cart-sidebar').classList.contains('active')) {
                    toggleCart();
                }
            };

            window.updateCartUI = function () {
                localStorage.setItem('pandaCart', JSON.stringify(cart));
                const container = document.getElementById('cart-drawer-items');
                const badge = document.querySelector('.cart-badge');
                const totalSpan = document.getElementById('cart-total-price');

                let total = 0;
                let count = 0;
                container.innerHTML = '';

                cart.forEach((item, index) => {
                    const priceNum = parseInt(item.price.replace(/[^\d]/g, ''));
                    total += priceNum * item.quantity;
                    count += item.quantity;

                    container.innerHTML += `
                        <div class="cart-item">
                            <img src="${item.img}" class="cart-item-img shadow-sm">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-1">
                                    <h6 class="fw-bold mb-0" style="font-size: 0.95rem;">${item.name}</h6>
                                    <button class="btn-close" style="font-size:0.6rem" onclick="removeItem(${index})"></button>
                                </div>
                                <div class="small text-muted mb-3" style="font-size: 0.8rem;">${item.price}</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center gap-3">
                                        <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
                                        <span class="fw-bold" style="min-width: 20px; text-align: center;">${item.quantity}</span>
                                        <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
                                    </div>
                                    <span class="fw-bold text-dark">Rs. ${priceNum * item.quantity}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                if (cart.length === 0) {
                    container.innerHTML = '<div class="text-center py-5"><i class="fa-solid fa-basket-shopping fa-3x text-light mb-3"></i><p class="text-muted">Your basket is empty</p></div>';
                }

                badge.innerText = count;
                totalSpan.innerText = `Rs. ${total}`;

                // --- Minimum Order Validation ---
                const warning = document.getElementById('min-order-warning');
                const checkoutBtn = document.getElementById('checkoutBtn');
                const minOrder = window.activeRestaurant ? window.activeRestaurant.minOrder : 300;

                if (total > 0 && total < minOrder) {
                    warning.classList.remove('d-none');
                    checkoutBtn.classList.add('disabled', 'opacity-50');
                    checkoutBtn.style.pointerEvents = 'none';
                } else {
                    warning.classList.add('d-none');
                    checkoutBtn.classList.remove('disabled', 'opacity-50');
                    checkoutBtn.style.pointerEvents = 'auto';
                }
            };

            window.proceedToCheckout = function () {
                const total = cart.reduce((sum, item) => sum + (parseInt(item.price.replace(/[^\d]/g, '')) * item.quantity), 0);
                const minOrder = window.activeRestaurant ? window.activeRestaurant.minOrder : 300;

                if (total < minOrder) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Minimum Order Required',
                        text: `Your order total (Rs. ${total}) is below the minimum required amount (Rs. ${minOrder}).`,
                        confirmButtonColor: '#E53935'
                    });
                    return;
                }
                window.location.href = 'checkout.html';
            };

            window.shareRestaurant = function () {
                const url = window.location.href;
                const shareData = {
                    title: restaurant.name + ' - Noshahi Panda',
                    text: 'Check out ' + restaurant.name + ' on Noshahi Panda!',
                    url: url
                };

                if (navigator.share) {
                    navigator.share(shareData).catch(err => console.log('Error sharing', err));
                } else {
                    // Fallback to Clipboard
                    navigator.clipboard.writeText(url).then(() => {
                        const btn = document.getElementById('shareBtn');
                        const originalText = btn.innerHTML;
                        btn.innerHTML = '<i class="fa-solid fa-check me-2"></i> Link Copied!';
                        btn.classList.replace('btn-outline-danger', 'btn-success');

                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.classList.replace('btn-success', 'btn-outline-danger');
                        }, 2000);

                        Swal.fire({
                            icon: 'success',
                            title: 'Link Copied',
                            text: 'Restaurant link copied to clipboard!',
                            timer: 2000,
                            showConfirmButton: false
                        });
                    });
                }
            };

            window.changeQty = function (index, delta) {
                cart[index].quantity += delta;
                if (cart[index].quantity <= 0) cart.splice(index, 1);
                updateCartUI();
            };

            window.removeItem = function (index) {
                cart.splice(index, 1);
                updateCartUI();
            };

            updateCartUI();
        });
    </script>
</body>

</html>