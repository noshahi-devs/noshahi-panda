<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Dashboard | Noshahi Panda</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --corp-blue: #0056b3;
            --sidebar-width: 260px;
        }

        body {
            background-color: #f4f7fa;
        }

        /* Sidebar Styling */
        .sidebar {
            width: var(--sidebar-width);
            background: #2c3e50;
            color: white;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 2.5rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-links {
            padding: 1.5rem 1rem;
        }

        .nav-item-db {
            display: flex;
            align-items: center;
            padding: 1rem 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .nav-item-db i {
            width: 24px;
            margin-right: 1rem;
            font-size: 1.2rem;
        }

        .nav-item-db:hover,
        .nav-item-db.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .nav-item-db.active {
            background: var(--brand-red);
            box-shadow: 0 4px 15px rgba(208, 2, 27, 0.3);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem;
        }

        .top-nav {
            background: white;
            padding: 1rem 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
            margin-bottom: 2rem;
        }

        .balance-card {
            background: linear-gradient(45deg, #1a1a1a, #444);
            color: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .balance-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: rgba(208, 2, 27, 0.1);
            border-radius: 50%;
        }

        .employee-badge {
            width: 40px;
            height: 40px;
            background: #eee;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--brand-red);
        }

        .allowance-input {
            width: 120px;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 5px 10px;
            font-size: 0.9rem;
        }

        @media (max-width: 992px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>

    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a class="navbar-brand d-flex align-items-center" href="index.html">
                    <div class="brand-logo me-2">
                        <span class="logo-n">N</span>
                    </div>
                    <span class="text-white fw-bold">Panda <span class="text-orange">Corporate</span></span>
                </a>
            </div>
            <nav class="nav-links">
                <a href="#" class="nav-item-db active"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
                <a href="#" class="nav-item-db"><i class="fa-solid fa-users"></i> Employees</a>
                <a href="#" class="nav-item-db"><i class="fa-solid fa-credit-card"></i> Billing</a>
                <a href="#" class="nav-item-db"><i class="fa-solid fa-utensils"></i> Group Orders</a>
                <a href="#" class="nav-item-db"><i class="fa-solid fa-file-contract"></i> Reports</a>
                <a href="#" class="nav-item-db"><i class="fa-solid fa-building-shield"></i> Company Profile</a>
                <hr class="my-4" style="border-color: rgba(255,255,255,0.1)">
                <a href="index.html" class="nav-item-db text-danger"><i class="fa-solid fa-right-from-bracket"></i> Sign
                    Out</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav d-flex justify-content-between align-items-center">
                <h4 class="fw-bold mb-0">Google INC - Pakistan</h4>
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-light rounded-pill px-4 btn-sm fw-bold border" data-bs-toggle="modal"
                        data-bs-target="#addResModal"><i class="fa-solid fa-plus me-2"></i>Add Restaurant</button>
                    <button class="btn btn-light rounded-pill px-4 btn-sm fw-bold border" data-bs-toggle="modal"
                        data-bs-target="#addRiderModal"><i class="fa-solid fa-plus me-2"></i>Add Rider</button>
                    <div class="employee-badge">G</div>
                </div>
            </div>

            <!-- SECTION: DASHBOARD -->
            <section id="section-dashboard">
                <div class="row g-4 mb-5">
                    <div class="col-lg-7">
                        <div class="balance-card h-100">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="text-white-50 text-uppercase fw-bold mb-3 small">Corporate Balance</h6>
                                    <h1 class="display-4 fw-bold mb-4">Rs. 248,500</h1>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-brand-red px-4 py-2 fw-bold rounded-3">Recharge
                                            Wallet</button>
                                        <button class="btn btn-outline-light px-4 py-2 fw-bold rounded-3">View
                                            Invoices</button>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end d-none d-md-block">
                                    <i class="fa-solid fa-building fa-6x text-white-50 opacity-25"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="card border-0 shadow-sm rounded-4 p-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="small text-muted">Total Riders</span>
                                <span class="h5 fw-bold mb-0" id="stat-total-riders">6</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="small text-muted">Active Restaurants</span>
                                <span class="h5 fw-bold mb-0" id="stat-total-res">24</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="small text-muted">Corporate Fleet Spending</span>
                                <span class="h5 fw-bold mb-0 text-brand-red">Rs. 1,240,000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    <div class="col-lg-6">
                        <div class="card border-0 shadow-sm rounded-4">
                            <div class="p-4 border-bottom d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold mb-0"><i class="fa-solid fa-utensils text-brand-red me-2"></i> New
                                    Restaurants</h5>
                                <span class="badge bg-light text-dark" id="res-count">0 Total</span>
                            </div>
                            <div class="table-responsive" style="max-height: 400px;">
                                <table class="table align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr class="small text-uppercase text-muted" style="font-size: 0.7rem;">
                                            <th class="ps-4">Restaurant</th>
                                            <th>Cuisine</th>
                                            <th>Status</th>
                                            <th class="text-end pe-4">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corp-res-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card border-0 shadow-sm rounded-4">
                            <div class="p-4 border-bottom d-flex justify-content-between align-items-center">
                                <h5 class="fw-bold mb-0"><i class="fa-solid fa-person-biking text-brand-red me-2"></i>
                                    New Riders</h5>
                                <span class="badge bg-light text-dark" id="rider-count">0 Total</span>
                            </div>
                            <div class="table-responsive" style="max-height: 400px;">
                                <table class="table align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr class="small text-uppercase text-muted" style="font-size: 0.7rem;">
                                            <th class="ps-4">Rider Name</th>
                                            <th>Vehicle</th>
                                            <th>Status</th>
                                            <th class="text-end pe-4">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="corp-rider-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: EMPLOYEES (RIDERS) -->
            <section id="section-employees" style="display: none;">
                <div class="card border-0 shadow-sm rounded-4 p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold mb-0">Fleet & Employees</h4>
                        <button class="btn btn-brand-red rounded-3 px-4 fw-bold" data-bs-toggle="modal"
                            data-bs-target="#addRiderModal">
                            <i class="fa-solid fa-user-plus me-2"></i>Hire New Rider
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-middle">
                            <thead class="bg-light">
                                <tr class="small text-uppercase text-muted">
                                    <th class="ps-4">Employee</th>
                                    <th>Role</th>
                                    <th>Contact</th>
                                    <th>Status</th>
                                    <th class="text-end pe-4">Manage</th>
                                </tr>
                            </thead>
                            <tbody id="full-employee-list">
                                <!-- Populated via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- SECTION: BILLING -->
            <section id="section-billing" style="display: none;">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm rounded-4 p-4 text-center">
                            <h6 class="text-muted small text-uppercase fw-bold mb-2">Next Billing Date</h6>
                            <h4 class="fw-bold">March 01, 2026</h4>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm rounded-4 p-4 text-center">
                            <h6 class="text-muted small text-uppercase fw-bold mb-2">Pending Invoices</h6>
                            <h4 class="fw-bold text-success">All Paid</h4>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm rounded-4 p-4 text-center">
                            <h6 class="text-muted small text-uppercase fw-bold mb-2">Auto-Recharge</h6>
                            <h4 class="fw-bold text-brand-red">Enabled</h4>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card border-0 shadow-sm rounded-4 p-4">
                            <h5 class="fw-bold mb-4">Billing History</h5>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead class="bg-light">
                                        <tr class="small text-muted">
                                            <th>Invoice ID</th>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th class="text-end">Download</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>#INV-9021</td>
                                            <td>Feb 01, 2026</td>
                                            <td class="fw-bold">Rs. 942,000</td>
                                            <td><span
                                                    class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">Paid</span>
                                            </td>
                                            <td class="text-end"><button class="btn btn-sm btn-light border"><i
                                                        class="fa-solid fa-file-pdf"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: GROUP ORDERS -->
            <section id="section-orders" style="display: none;">
                <div class="card border-0 shadow-sm rounded-4 p-5 text-center">
                    <div class="mb-4"><i class="fa-solid fa-utensils fa-4x text-light"></i></div>
                    <h4 class="fw-bold">Group Orders Management</h4>
                    <p class="text-muted px-lg-5">Active group orders for your company will appear here. You can set
                        daily budgets for employee lunches and organize corporate dinners.</p>
                    <div class="mt-3">
                        <button class="btn btn-brand-red px-5 py-2 fw-bold rounded-3">Start Group Order</button>
                    </div>
                </div>
            </section>

            <!-- SECTION: REPORTS -->
            <section id="section-reports" style="display: none;">
                <div class="card border-0 shadow-sm rounded-4 p-4">
                    <h4 class="fw-bold mb-4">Analytics & Reports</h4>
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="p-5 border rounded-4 bg-light text-center"><i
                                    class="fa-solid fa-chart-pie fa-3x mb-3 text-muted"></i>
                                <h6>Monthly Spending Report</h6>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="p-5 border rounded-4 bg-light text-center"><i
                                    class="fa-solid fa-chart-line fa-3x mb-3 text-muted"></i>
                                <h6>Rider Efficiency Analytics</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: COMPANY PROFILE -->
            <section id="section-profile" style="display: none;">
                <div class="card border-0 shadow-sm rounded-4 p-4">
                    <h4 class="fw-bold mb-4">Company Profile Settings</h4>
                    <form class="row g-3">
                        <div class="col-md-6"><label class="form-label small fw-bold">Company Name</label><input
                                type="text" class="form-control" value="Google INC - Pakistan"></div>
                        <div class="col-md-6"><label class="form-label small fw-bold">Admin Email</label><input
                                type="email" class="form-control" value="admin@google.com.pk"></div>
                        <div class="col-12"><label class="form-label small fw-bold">Business Address</label><textarea
                                class="form-control">Level 12, Arfa Software Technology Park, Lahore</textarea></div>
                        <div class="col-12 mt-4 text-end"><button class="btn btn-dark px-5 fw-bold rounded-3">Save
                                Changes</button></div>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Profile Detail Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold" id="profile-title">Partner Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4" id="profile-details">
                    <!-- Dynamic Profile Info -->
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-light rounded-3 px-4" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Restaurant Modal -->
    <div class="modal fade" id="addResModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Onboard New Restaurant</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="add-res-form">
                    <div class="modal-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label small fw-bold">Restaurant Name</label>
                                <input type="text" class="form-control" name="resName" required
                                    placeholder="Olive Garden">
                            </div>
                            <div class="col-12">
                                <label class="form-label small fw-bold">Owner Name</label>
                                <input type="text" class="form-control" name="ownerName" required
                                    placeholder="Marco Polo">
                            </div>
                            <div class="col-12">
                                <label class="form-label small fw-bold">Email Address</label>
                                <input type="email" class="form-control" name="email" required
                                    placeholder="owner@restaurant.com">
                            </div>
                            <div class="col-12">
                                <label class="form-label small fw-bold">Cuisine Type</label>
                                <select class="form-select" name="cuisine" required>
                                    <option value="Italian">Italian</option>
                                    <option value="Desi">Desi</option>
                                    <option value="Chinese">Chinese</option>
                                    <option value="Fast Food">Fast Food</option>
                                    <option value="Japanese">Japanese</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn btn-light rounded-3 px-4"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-brand-red rounded-3 px-4 fw-bold">Register
                            Restaurant</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Rider Modal (Custom Employee) -->
    <div class="modal fade" id="addRiderModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Add New Rider (Employee)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="add-rider-form">
                    <div class="modal-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label small fw-bold">Full Name</label>
                                <input type="text" class="form-control" name="name" required placeholder="Abaid Ullah">
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">Email</label>
                                <input type="email" class="form-control" name="email" required
                                    placeholder="abaid@panda.com">
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">City</label>
                                <input type="text" class="form-control" name="city" required placeholder="Lahore">
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">Vehicle</label>
                                <select class="form-select" name="vehicle" required>
                                    <option value="Motorbike">Motorbike</option>
                                    <option value="Car">Car</option>
                                    <option value="Bicycle">Bicycle</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label small fw-bold">Monthly Salary (Rs.)</label>
                                <input type="number" class="form-control" name="salary" required value="25000">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn btn-light rounded-3 px-4"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-brand-red rounded-3 px-4 fw-bold">Hire Rider</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Example Data to seed
        const exampleRestaurants = [
            { name: "Olive Garden", owner: "Marco Polo", email: "marco@olive.com", cuisine: "Italian", date: "2/10/2026", status: "Active" },
            { name: "Spice Village", owner: "Ali Khan", email: "ali@spice.com", cuisine: "Desi", date: "2/09/2026", status: "Suspended" },
            { name: "Sushi House", owner: "Kenji Sato", email: "kenji@sushi.com", cuisine: "Japanese", date: "2/08/2026", status: "Active" }
        ];

        const exampleRiders = [
            { name: "Hamza Malik", email: "hamza@rider.com", city: "Lahore", vehicle: "Motorbike", date: "2/11/2026", status: "Active", salary: 35000, rating: 4.8 },
            { name: "Zainab Ahmed", email: "zainab@rider.com", city: "Karachi", vehicle: "Bicycle", date: "2/10/2026", status: "Active", salary: 28000, rating: 4.9 },
            { name: "Usman Rao", email: "usman@rider.com", city: "Islamabad", vehicle: "Car", date: "2/09/2026", status: "Suspended", salary: 45000, rating: 4.5 }
        ];

        function renderTables() {
            let allRestaurants = JSON.parse(localStorage.getItem('noshahi_all_restaurants') || '[]');
            let allRiders = JSON.parse(localStorage.getItem('noshahi_all_riders') || '[]');

            if (localStorage.getItem('noshahi_all_restaurants') === null) {
                localStorage.setItem('noshahi_all_restaurants', JSON.stringify(exampleRestaurants));
                allRestaurants = exampleRestaurants;
            }
            if (localStorage.getItem('noshahi_all_riders') === null) {
                localStorage.setItem('noshahi_all_riders', JSON.stringify(exampleRiders));
                allRiders = exampleRiders;
            }

            const resListElem = document.getElementById('corp-res-list');
            const riderListElem = document.getElementById('corp-rider-list');
            const employeeListElem = document.getElementById('full-employee-list');
            const resCount = document.getElementById('res-count');
            const riderCount = document.getElementById('rider-count');

            // Update Stats
            document.getElementById('stat-total-riders').innerText = allRiders.length;
            document.getElementById('stat-total-res').innerText = allRestaurants.length;
            const totalSpending = allRiders.reduce((acc, r) => acc + (r.salary || 0), 0);
            const spendingElem = document.querySelector('.text-brand-red.h5');
            if (spendingElem) spendingElem.innerText = `Rs. ${totalSpending.toLocaleString()}`;

            // Populate Overview Restaurants
            if (resListElem) {
                resCount.innerText = `${allRestaurants.length} Total`;
                resListElem.innerHTML = allRestaurants.slice().reverse().map((res, index) => {
                    const actualIndex = allRestaurants.length - 1 - index;
                    const statusClass = res.status === 'Active' ? 'bg-success' : 'bg-warning text-dark';
                    return `
                        <tr>
                            <td class="ps-4"><div class="fw-bold">${res.name}</div><div class="small text-muted">${res.owner}</div></td>
                            <td><span class="small">${res.cuisine}</span></td>
                            <td><span class="badge ${statusClass} bg-opacity-10 ${res.status === 'Active' ? 'text-success' : 'text-warning'} rounded-pill px-2 py-1" style="font-size:0.7rem">${res.status || 'Active'}</span></td>
                            <td class="text-end pe-4">
                                <div class="btn-group">
                                    <button onclick="viewProfile('restaurant', ${actualIndex})" class="btn btn-sm btn-outline-primary border-0"><i class="fa-solid fa-eye"></i></button>
                                    <button onclick="toggleStatus('restaurant', ${actualIndex})" class="btn btn-sm btn-outline-secondary border-0"><i class="fa-solid fa-toggle-${res.status === 'Active' ? 'on' : 'off'}"></i></button>
                                    <button onclick="deleteEntry('restaurant', ${actualIndex})" class="btn btn-sm btn-outline-danger border-0"><i class="fa-solid fa-trash-can"></i></button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // Populate Overview Riders
            if (riderListElem) {
                riderCount.innerText = `${allRiders.length} Total`;
                riderListElem.innerHTML = allRiders.slice().reverse().map((rider, index) => {
                    const actualIndex = allRiders.length - 1 - index;
                    const statusClass = rider.status === 'Active' ? 'bg-success' : 'bg-warning text-dark';
                    return `
                        <tr>
                            <td class="ps-4"><div class="fw-bold">${rider.name}</div><div class="small text-muted">${rider.email}</div></td>
                            <td><span class="small">${rider.vehicle}</span></td>
                            <td><span class="badge ${statusClass} bg-opacity-10 ${rider.status === 'Active' ? 'text-success' : 'text-warning'} rounded-pill px-2 py-1" style="font-size:0.7rem">${rider.status || 'Active'}</span></td>
                            <td class="text-end pe-4">
                                <button onclick="viewProfile('rider', ${actualIndex})" class="btn btn-sm btn-outline-primary border-0"><i class="fa-solid fa-eye"></i></button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // Populate Full Employee Section
            if (employeeListElem) {
                employeeListElem.innerHTML = allRiders.map((rider, index) => `
                    <tr>
                        <td class="ps-4"><div class="fw-bold">${rider.name}</div><div class="small text-muted">${rider.email}</div></td>
                        <td><div class="small fw-bold">Rider Fleet</div><div class="text-muted" style="font-size:0.7rem">${rider.vehicle}</div></td>
                        <td><div class="small">${rider.city}</div></td>
                        <td><span class="badge bg-${rider.status === 'Active' ? 'success' : 'warning'} bg-opacity-10 text-${rider.status === 'Active' ? 'success' : 'warning'} rounded-pill px-3">${rider.status}</span></td>
                        <td class="text-end pe-4">
                             <div class="btn-group">
                                <button onclick="viewProfile('rider', ${index})" class="btn btn-sm btn-light border"><i class="fa-solid fa-gear"></i></button>
                                <button onclick="deleteEntry('rider', ${index})" class="btn btn-sm btn-outline-danger border ms-2"><i class="fa-solid fa-trash"></i></button>
                             </div>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Navigation Logic
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-item-db');
            const sections = {
                'Dashboard': document.getElementById('section-dashboard'),
                'Employees': document.getElementById('section-employees'),
                'Billing': document.getElementById('section-billing'),
                'Group Orders': document.getElementById('section-orders'),
                'Reports': document.getElementById('section-reports'),
                'Company Profile': document.getElementById('section-profile')
            };

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    const text = link.innerText.trim();
                    if (sections[text]) {
                        e.preventDefault();
                        // Update UI
                        navLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        // Switch Sections
                        Object.values(sections).forEach(s => s.style.display = 'none');
                        sections[text].style.display = 'block';

                        renderTables();
                    }
                });
            });

            renderTables();
        });

        function viewProfile(type, index) {
            const key = type === 'restaurant' ? 'noshahi_all_restaurants' : 'noshahi_all_riders';
            const data = JSON.parse(localStorage.getItem(key));
            const partner = data[index];
            const modalBody = document.getElementById('profile-details');
            const modalTitle = document.getElementById('profile-title');

            modalTitle.innerText = `${type.charAt(0).toUpperCase() + type.slice(1)} Profile`;

            // Photo handling: use captured photo or fallback to brand icon
            const photoHtml = (type === 'rider' && partner.photo)
                ? `<div class="mb-3 text-center">
                    <img src="${partner.photo}" class="rounded-circle shadow-sm border p-1" style="width: 120px; height: 120px; object-fit: cover;">
                   </div>`
                : `<div class="bg-brand-red bg-opacity-10 text-brand-red rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="fa-solid fa-${type === 'restaurant' ? 'utensils' : 'person-biking'} fa-2x"></i>
                   </div>`;

            let detailsHtml = `
                <div class="text-center mb-4">
                    ${photoHtml}
                    <h4 class="fw-bold mb-0">${partner.name}</h4>
                    <span class="badge ${partner.status === 'Active' ? 'bg-success' : 'bg-warning text-dark'} bg-opacity-10 ${partner.status === 'Active' ? 'text-success' : 'text-warning'} rounded-pill px-3 mt-2">${partner.status || 'Active'}</span>
                </div>
                <div class="row g-3">
            `;

            if (type === 'restaurant') {
                detailsHtml += `
                    <div class="col-6"><label class="small text-muted d-block">Owner Name</label><strong>${partner.owner}</strong></div>
                    <div class="col-6"><label class="small text-muted d-block">Cuisine</label><strong>${partner.cuisine}</strong></div>
                    <div class="col-12"><label class="small text-muted d-block">Email Address</label><strong>${partner.email}</strong></div>
                    <div class="col-12"><label class="small text-muted d-block">Registration Date</label><strong>${partner.date || 'N/A'}</strong></div>
                `;
            } else {
                detailsHtml += `
                    <div class="col-6"><label class="small text-muted d-block">Contact Name</label><strong>${partner.name}</strong></div>
                    <div class="col-6"><label class="small text-muted d-block">City</label><strong>${partner.city}</strong></div>
                    <div class="col-6"><label class="small text-muted d-block">Monthly Salary</label><strong class="text-success">Rs. ${(partner.salary || 25000).toLocaleString()}</strong></div>
                    <div class="col-6"><label class="small text-muted d-block">Perf. Rating</label><strong><i class="fa-solid fa-star text-warning me-1"></i>${partner.rating || '5.0'}</strong></div>
                    <div class="col-12"><label class="small text-muted d-block">Vehicle Type</label><strong>${partner.vehicle}</strong></div>
                    <div class="col-12"><label class="small text-muted d-block">Email Address</label><strong>${partner.email}</strong></div>
                    <div class="col-12"><label class="small text-muted d-block">Member Since</label><strong>${partner.date || 'N/A'}</strong></div>
                `;
            }

            detailsHtml += `</div>`;
            modalBody.innerHTML = detailsHtml;

            const myModal = new bootstrap.Modal(document.getElementById('profileModal'));
            myModal.show();
        }

        function toggleStatus(type, index) {
            const key = type === 'restaurant' ? 'noshahi_all_restaurants' : 'noshahi_all_riders';
            let data = JSON.parse(localStorage.getItem(key));
            data[index].status = data[index].status === 'Active' ? 'Suspended' : 'Active';
            localStorage.setItem(key, JSON.stringify(data));
            renderTables();
        }

        function deleteEntry(type, index) {
            const key = type === 'restaurant' ? 'noshahi_all_restaurants' : 'noshahi_all_riders';
            let data = JSON.parse(localStorage.getItem(key));
            const targetName = data[index].name;

            if (confirm(`Are you sure you want to delete ${targetName}?`)) {
                data.splice(index, 1);
                localStorage.setItem(key, JSON.stringify(data));
                renderTables();
            }
        }

        // Handle Add Restaurant Form
        const resForm = document.getElementById('add-res-form');
        if (resForm) {
            resForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(resForm);
                const newRes = {
                    name: formData.get('resName'),
                    owner: formData.get('ownerName'),
                    email: formData.get('email'),
                    cuisine: formData.get('cuisine'),
                    date: new Date().toLocaleDateString(),
                    status: 'Active'
                };

                let allRestaurants = JSON.parse(localStorage.getItem('noshahi_all_restaurants') || '[]');
                allRestaurants.push(newRes);
                localStorage.setItem('noshahi_all_restaurants', JSON.stringify(allRestaurants));

                renderTables();
                const modalInstance = bootstrap.Modal.getInstance(document.getElementById('addResModal'));
                if (modalInstance) modalInstance.hide();
                resForm.reset();
            });
        }

        // Handle Add Rider Form
        const riderForm = document.getElementById('add-rider-form');
        if (riderForm) {
            riderForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(riderForm);
                const newRider = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    city: formData.get('city'),
                    vehicle: formData.get('vehicle'),
                    salary: parseInt(formData.get('salary')),
                    rating: 5.0, // Default for new hire
                    date: new Date().toLocaleDateString(),
                    status: 'Active'
                };

                let allRiders = JSON.parse(localStorage.getItem('noshahi_all_riders') || '[]');
                allRiders.push(newRider);
                localStorage.setItem('noshahi_all_riders', JSON.stringify(allRiders));

                renderTables();
                const modalInstance = bootstrap.Modal.getInstance(document.getElementById('addRiderModal'));
                if (modalInstance) modalInstance.hide();
                riderForm.reset();
            });
        }
    </script>
</body>

</html>